{% extends "base.html" %}
{% block content %}

<section class="page-header">
    <div>
        <h2>ğŸ“– Recipe Bank</h2>
        <p class="page-subtitle">
            Manage manufacturing recipes for standardized production processes
        </p>
    </div>
    <div class="page-header-actions">
        <a href="/" class="btn btn-ghost">â† Back to Dashboard</a>
    </div>
</section>

<section class="grid-main">
    <div class="panel">
        <div class="panel-header">
            <h3>ğŸ“‹ Available Recipes</h3>
            <p class="panel-subtitle">Click on any recipe to view details</p>
        </div>
        <div class="table-wrapper">
            <table>
                <thead>
                <tr>
                    <th style="width: 50px;">ID</th>
                    <th style="width: 200px;">Name</th>
                    <th style="width: auto;">Description</th>
                    <th style="width: 150px;">Created At</th>
                    <th style="width: 120px;">Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for r in recipes %}
                <tr>
                    <td><strong>#{{ r.id }}</strong></td>
                    <td><strong>{{ r.name }}</strong></td>
                    <td title="{{ r.description }}">{{ r.description or 'No description' }}</td>
                    <td>{{ r.created_at.strftime('%Y-%m-%d') if r.created_at else 'â€”' }}</td>
                    <td>
                        <button type="button" class="btn btn-small btn-info" onclick="viewRecipe({{ r.id }}, '{{ r.name }}', '{{ r.description or '' }}', '{{ r.ingredients or '' }}', '{{ r.instructions or '' }}')">
                            ğŸ‘ï¸ View
                        </button>
                        {% if current_user.role.value == 'management' %}
                        <form action="/delete-recipe/{{ r.id }}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Are you sure you want to delete this recipe?')">
                                ğŸ—‘ï¸
                            </button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                {% if not recipes %}
                <tr>
                    <td colspan="5" class="text-center">No recipes added yet. Create your first recipe!</td>
                </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    {% if current_user.role.value == 'management' %}
    <div class="panel">
        <div class="panel-header">
            <h3>â• Add New Recipe</h3>
            <p class="panel-subtitle">Create a standardized manufacturing recipe</p>
        </div>
        <form action="/create-recipe" method="post" class="form">
            <div class="form-field">
                <label for="r_name">ğŸ“ Recipe Name</label>
                <input id="r_name" type="text" name="name" required 
                       placeholder="e.g. Standard Widget Assembly">
            </div>

            <div class="form-field">
                <label for="r_desc">ğŸ’¬ Description</label>
                <textarea id="r_desc" name="description" rows="2"
                          placeholder="Brief description of the recipe"></textarea>
            </div>

            <div class="form-field">
                <label for="r_ingredients">ğŸ§ª Ingredients/Materials</label>
                <textarea id="r_ingredients" name="ingredients" rows="3"
                          placeholder="List all required materials, one per line:
- SS Sheet 2mm (500kg)
- Plastic Pellets (200kg)
- Bolts M8 (1000 pieces)"></textarea>
            </div>

            <div class="form-field">
                <label for="r_instructions">ğŸ“‹ Manufacturing Instructions</label>
                <textarea id="r_instructions" name="instructions" rows="5"
                          placeholder="Step-by-step manufacturing process:
1. Prepare raw materials
2. Cut SS sheets to size
3. Mold plastic components
4. Assemble parts
5. Quality inspection"></textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Save Recipe</button>
            </div>
        </form>
    </div>
    {% else %}
    <div class="panel" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; padding: 40px;">
        <h3 style="color: white; margin-bottom: 10px;">ğŸ“– Read-Only Access</h3>
        <p style="opacity: 0.9;">You can view all recipes but cannot add or delete them. Contact management for changes.</p>
    </div>
    {% endif %}
</section>

<!-- Recipe Details Modal -->
<div id="recipeModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h3>ğŸ“– Recipe Details</h3>
            <p class="page-subtitle" id="modalRecipeName"></p>
        </div>
        
        <div class="form">
            <div class="form-field">
                <label>ğŸ’¬ Description</label>
                <div id="modalRecipeDescription" style="background: #0f172a; padding: 12px; border-radius: 8px; border: 2px solid #334155; color: #f1f5f9;">
                    No description provided
                </div>
            </div>
            
            <div class="form-field">
                <label>ğŸ§ª Ingredients/Materials</label>
                <div id="modalRecipeIngredients" style="background: #0f172a; padding: 12px; border-radius: 8px; border: 2px solid #334155; white-space: pre-wrap; color: #f1f5f9;">
                    No ingredients listed
                </div>
            </div>
            
            <div class="form-field">
                <label>ğŸ“‹ Manufacturing Instructions</label>
                <div id="modalRecipeInstructions" style="background: #0f172a; padding: 12px; border-radius: 8px; border: 2px solid #334155; white-space: pre-wrap; color: #f1f5f9;">
                    No instructions provided
                </div>
            </div>
        </div>
        
        <div class="modal-actions">
            <button type="button" class="btn btn-primary" onclick="closeRecipeModal()">Close</button>
        </div>
    </div>
</div>

<script>
function viewRecipe(id, name, description, ingredients, instructions) {
    document.getElementById('modalRecipeName').textContent = name;
    document.getElementById('modalRecipeDescription').textContent = description || 'No description provided';
    document.getElementById('modalRecipeIngredients').textContent = ingredients || 'No ingredients listed';
    document.getElementById('modalRecipeInstructions').textContent = instructions || 'No instructions provided';
    document.getElementById('recipeModal').classList.add('active');
}

function closeRecipeModal() {
    document.getElementById('recipeModal').classList.remove('active');
}

// Close modal on outside click
document.getElementById('recipeModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeRecipeModal();
    }
});

// Close modal on ESC key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeRecipeModal();
    }
});
</script>

{% endblock %}